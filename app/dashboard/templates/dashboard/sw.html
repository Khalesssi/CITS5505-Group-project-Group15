{% extends "base.html" %}

{% block content %}
<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-100 p-6 border-r">
    <h2 class="text-xl font-bold mb-6">Support Worker</h2>
    <ul id="sidebarLinks" class="space-y-4 text-gray-700">
      <li><a href="#profile" class="sidebar-link text-indigo-700 font-semibold">Personal Info</a></li>
      <li><a href="#daily-report" class="sidebar-link hover:underline">Daily Report</a></li>
      <li><a href="#report-record" class="sidebar-link hover:underline">Report Record</a></li>
      <li><a href="#medical" class="sidebar-link hover:underline">Medical Instructions</a></li>
    </ul>
  </aside>


  <!-- Main Content -->
  <main class="flex-1 p-8">

     <!--  Flash message block insert -->
    {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="p-4 mb-4 text-sm text-green-800 bg-green-100 rounded-lg border border-green-300">
      {{ messages[0] }}
      </div>
    {% endif %}
    {% endwith %}
    <!-- Personal profile Section -->
    <section id="profile" class="content-section space-y-6">
      <!-- Personal profile content -->
      <div class="bg-white rounded-lg shadow p-6 relative transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
        <h3 class="text-xl font-bold mb-4">Personal Information</h3>
        <div class="flex items-center gap-8 mb-6">
          <div class="w-40 h-40">
            <img src="{{ url_for('static', filename='images/support_worker_avatar.jpg') }}" 
                 alt="Support Worker Photo" 
                 class="w-full h-full object-cover rounded-full border-4 border-indigo-500">
          </div>
          <div class="grid grid-cols-1 gap-2">
            <p class="text-gray-600">Name: <span class="text-gray-800">Wang Xiaoming</span></p>
            <p class="text-gray-600">Email: <span class="text-gray-800">support@example.com</span></p>
            <p class="text-gray-600">Phone: <span class="text-gray-800">0912-345-678</span></p>
          </div>
          <p class="absolute bottom-0 right-0 p-6 text-xs text-gray-500">Account Created: 2024-03-15</p>
        </div>
      </div>

      <!-- education -->
      <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
        <h3 class="text-xl font-bold mb-4">Education</h3>
        <ul class="list-disc list-inside text-gray-600 space-y-1">
          <li>2018 - Bachelor of Nursing, Taipei Nursing University</li>
          <li>2020 - Caregiver Certification</li>
        </ul>
      </div>

      <!-- experience -->
      <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
        <h3 class="text-xl font-bold mb-4">Work Experience</h3>
        <ul class="list-disc list-inside text-gray-600 space-y-1">
          <li>2020-2022 Caregiver at Taipei Hospital</li>
          <li>2022-Present Home Caregiver</li>
        </ul>
      </div>
    </section>


    <!-- Daily report Section -->
<section id="daily-report" class="content-section hidden">
  <div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <h3 class="text-xl font-bold mb-6">Daily Patient Report</h3>

    <!-- 开始整个表单 -->
    <form id="daily-form" action="{{ url_for('questionnaire.submit_questionnaire') }}" method="POST">
      

      <!-- Report detail:time and select patient -->
      <div class="grid grid-cols-2 gap-6 mb-8">
        <div class="flex items-center">
          <span class="text-gray-700 font-medium min-w-32">Report Date:</span>
          <span class="text-gray-900">2024-03-15</span>
        </div>
        <div class="flex items-center">
          <span class="text-gray-700 font-medium min-w-32">Patient Name:</span>
          <!--Patient selection-->
          <select name="patient_id" required class="w-40 h-10 border rounded-md px-2 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            <option value="" disabled selected>Select a patient</option>
            {% for patient in patients %}
              <option value="{{ patient.id }}">{{ patient.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- 問卷表格 - 保留原样 -->
      <div class="overflow-hidden rounded-lg border border-gray-200">
        <div class="max-h-[800px] overflow-y-auto">
          <table class="w-full border-collapse">
            <thead class="sticky top-0 bg-white">
              <tr class="bg-gray-100">
                <th class="w-24 border-b border-gray-200 px-6 py-4 text-sm font-semibold text-gray-800 text-center">No.</th>
                <th class="max-w-xl border-b border-gray-200 px-6 py-4 text-sm font-semibold text-gray-800 text-left">Question</th>
                <th class="w-48 border-b border-gray-200 px-6 py-4 text-sm font-semibold text-gray-800 text-center">Answer</th>
              </tr>
            </thead>
            <tbody>
                <!-- 1. Emotional Stability -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">1</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Is the patient's emotion stable today?
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question1" required class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                      <option value="" disabled selected>Select</option>
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </td>
                </tr>
                <!-- 2. Pain Occurrence -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">2</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">Did the patient experience any pain today?</td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question2" required class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center">
                      <option value="" disabled selected>Select</option>
                      <option>Yes</option>
                      <option>No</option>
                    </select>
                  </td>
                </tr>
                <!-- 3. Physical Energy Level -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">3</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Patient's physical energy level (1-5)
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question3" min="1" max="5" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 4. Food Intake -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">4</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Patient's food intake today 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question4" class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" required>
                      <option value="" disabled selected>Select</option>
                      <option value="Normal">Normal</option>
                      <option value="Reduced">Reduced</option>
                      <option value="Excessive">Excessive</option>
                    </select>
                  </td>
                </tr>
                <!-- 5. Daily Activities Completion -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">5</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Did the patient complete daily activities today? 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question5" class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" required>
                      <option value="" disabled selected>Select</option>
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </td>
                </tr>
                <!-- 6. Physical Training Completion -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">6</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Physical training completion percentage (0-100%) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question6" min="0" max="100" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 7. Post-Exercise Pain Score -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">7</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Post-exercise pain score (1-10) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question7" min="1" max="10" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 8. Balance Ability Score -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">8</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Patient's balance ability score (1-5) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question8" min="1" max="5" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 9. Self-Care Participation Willingness -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">9</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Willingness to participate in self-care activities (1-5) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question9" min="1" max="5" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 10. Household Task Completion -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">10</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    How did the patient complete household tasks today? 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question10" class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" required>
                      <option value="" disabled selected>Select</option>
                      <option value="Completed">Completed</option>
                      <option value="Partially Completed">Partially Completed</option>
                      <option value="Not Completed">Not Completed</option>
                    </select>
                  </td>
                </tr>
                <!-- 11. New Skill Learning Performance -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">11</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    How was the patient's performance in learning new skills? 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question11" class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" required>
                      <option value="" disabled selected>Select</option>
                      <option value="Good">Good</option>
                      <option value="Average">Average</option>
                      <option value="Poor">Poor</option>
                    </select>
                  </td>
                </tr>
                <!-- 12. Emotional Fluctuations Count -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">12</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Number of emotional fluctuations today 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question12" min="0" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 13. Social Interaction Willingness -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">13</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Willingness for social interaction (1-5) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question13" min="1" max="5" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 14. Therapist Guidance Responsiveness -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">14</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Patient's responsiveness to therapist's guidance (1-5) 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <input type="number" name="question14" min="1" max="5" required 
                           class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" />
                  </td>
                </tr>
                <!-- 15. Signs of Anxiety or Depression -->
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                  <td class="border-b border-gray-200 px-6 py-4 text-center text-gray-600">15</td>
                  <td class="border-b border-gray-200 px-6 py-4 text-left font-medium text-gray-800 max-w-xl truncate">
                    Were any signs of anxiety or depression observed today? 
                  </td>
                  <td class="border-b border-gray-200 px-6 py-4">
                    <select name="question15"  class="w-full h-10 border rounded-md px-4 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-center" required>
                      <option value="" disabled selected>Select</option>
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </td>
                </tr>
                
              </tbody>
            </table>
          </div>
        </div>
  
        <!-- Submit Button -->
        <div class="mt-6 flex justify-end">
          <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded-md hover:bg-indigo-700 transition-colors">
            Submit Report
          </button>
        </div>
  
      </form> <!-- 结束整个表单 -->
    </div>
  </section>

    <!-- 病患狀況歷史 Section -->
    <section id="report-record" class="content-section hidden">
      <div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
        <h3 class="text-xl font-bold mb-6">Patient History</h3>
        <!-- Selection Area -->
        <div class="grid grid-cols-2 gap-6 mb-8">
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center mb-3">
              <span class="font-medium text-gray-700">Report Date:</span>
              <input class="border rounded-md px-3 py-1.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" id="reportDate" type="date"/>
            </div>
            <div class="flex justify-between items-center">
              <span class="font-medium text-gray-700">Support Worker:</span>
              <span class="text-gray-900 font-medium" id="supportWorkerName">No Data</span>
            </div>
          </div>
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="font-medium text-gray-700">Patient Name:</span>
              <select class="border rounded-md px-3 py-1.5 bg-white w-48 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" id="patientSelect">
                <option value="James Wilson">James Wilson</option>
                <option value="Oliver Thompson">Oliver Thompson</option>
                <option value="William Parker">William Parker</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Table Area -->
        <div class="overflow-hidden rounded-lg border border-gray-200">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-100">
                <th class="text-gray-800 align-middle text-sm w-12 py-3 px-4 text-center font-semibold border-gray-200 border-b whitespace-nowrap">No.</th>
                <th class="border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-left">Question</th>
                <th class="w-48 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-center">Answer</th>
              </tr>
            </thead>
            <tbody id="reportTableBody">
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 醫囑 Section -->
    <section id="medical" class="content-section hidden">
      <div class="medical-container">
        <h3 class="text-xl font-bold mb-4">Medical Instructions</h3>
        
        <!-- 添加選擇區域 -->
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="bg-white rounded-lg shadow p-4 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
            <label class="block text-sm font-medium text-gray-700 mb-2">Patient Name</label>
            <select class="w-full border rounded-md px-3 py-2">
              <option>Li Dahua</option>
              <option>Zhang Xiaoming</option>
            </select>
          </div>
          <div class="bg-white rounded-lg shadow p-4 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
            <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
            <select class="w-full border rounded-md px-3 py-2">
              <option>2024-03-15</option>
              <option>2024-03-14</option>
              <option>2024-03-13</option>
            </select>
          </div>
        </div>
        
        <!-- 醫囑內容 -->
        <div class="mb-8">
          <!-- Psychotherapist Instructions -->
          <div class="mb-6">
            <h5 class="text-md font-semibold mb-2">Psychotherapist Instructions</h5>
            <div class="bg-orange-50 p-4 rounded border-l-4 border-orange-400 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
              <ul class="space-y-2">
                <li class="flex items-start">
                  <span class="text-orange-600 mr-2">•</span>
                  <span>Encourage patient to express feelings about recovery process</span>
                </li>
                <li class="flex items-start">
                  <span class="text-orange-600 mr-2">•</span>
                  <span>Practice relaxation techniques during stressful moments</span>
                </li>
                <li class="flex items-start">
                  <span class="text-orange-600 mr-2">•</span>
                  <span>Monitor for signs of anxiety or depression</span>
                </li>
              </ul>
            </div>
          </div>
          
          <!-- Physiotherapist Instructions -->
          <div class="mb-6">
            <h5 class="text-md font-semibold mb-2">Physiotherapist Instructions</h5>
            <div class="bg-yellow-50 p-4 rounded border-l-4 border-yellow-400 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
              <ul class="space-y-2">
                <li class="flex items-start">
                  <span class="text-yellow-600 mr-2">•</span>
                  <span>Blood pressure medication - Take twice daily, after meals</span>
                </li>
                <li class="flex items-start">
                  <span class="text-yellow-600 mr-2">•</span>
                  <span>Activity - 30 minutes of walking daily, requires accompaniment</span>
                </li>
                <li class="flex items-start">
                  <span class="text-yellow-600 mr-2">•</span>
                  <span>Wound care - Change dressing twice daily, maintain cleanliness</span>
                </li>
              </ul>
            </div>
          </div>
          
          <!-- Occupational Therapist Instructions -->
          <div class="mb-6">
            <h5 class="text-md font-semibold mb-2">Occupational Therapist Instructions</h5>
            <div class="bg-green-50 p-4 rounded border-l-4 border-green-400 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
              <ul class="space-y-2">
                <li class="flex items-start">
                  <span class="text-green-600 mr-2">•</span>
                  <span>Practice daily living activities with supervision</span>
                </li>
                <li class="flex items-start">
                  <span class="text-green-600 mr-2">•</span>
                  <span>Use adaptive equipment for meal preparation</span>
                </li>
                <li class="flex items-start">
                  <span class="text-green-600 mr-2">•</span>
                  <span>Encourage participation in leisure activities</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  // 導航功能
  document.addEventListener('DOMContentLoaded', function () {
    const links = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('main section');

    links.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);

        sections.forEach(section => {
          section.classList.add('hidden');
          if (section.id === targetId) {
            section.classList.remove('hidden');
          }
        });

        links.forEach(l => l.classList.remove('text-indigo-700', 'font-semibold'));
        this.classList.add('text-indigo-700', 'font-semibold');
      });
    });
  });

  // 設置預設日期為今天
  document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.querySelectorAll('input[type="date"]').forEach(input => {
      input.value = today;
    });
  });

  // 定義問題列表
  const questions = [
      "How is the patient's mental status today?",
      "Did the patient take their medication on time?",
      "Food intake score",
      "Did the patient complete today's rehabilitation activity?",
      "Sleep quality score",
      "Any abnormal symptoms?",
      "Emotional stability score",
      "Did the patient follow the doctor's instructions?",
      "Activity participation score",
      "Any social interaction?"
  ];

  // 定義可用的 Support Worker 列表
  const supportWorkers = ["Michael Smith", "George Davies", "Emma Taylor"];

  // 使用日期和病患名作為 key 來確保同一天同一個病患對應到同一個 Support Worker
  function getConsistentSupportWorker(date, patient) {
      const seed = date + patient;
      let hash = 0;
      for (let i = 0; i < seed.length; i++) {
          hash = ((hash << 5) - hash) + seed.charCodeAt(i);
          hash = hash & hash;
      }
      return supportWorkers[Math.abs(hash) % supportWorkers.length];
  }

  // 修改生成答案的部分
  function generateDailyAnswers(date, patient) {
      // 評分對應設定
      const ratings = {
          1: { text: "Poor", class: "text-red-500" },
          3: { text: "Average", class: "text-yellow-600" },
          5: { text: "Good", class: "text-green-600" }
      };

      // 生成評分答案
      function getRandomScore() {
          const scores = [1, 3, 5];
          const score = scores[Math.floor(Math.random() * 3)];
          return { 
              score: score.toString(),
              text: ratings[score].text,
              class: ratings[score].class
          };
      }

      return [
          getRandomScore(),
          formatYesNoAnswer(Math.random() < 0.7),
          getRandomScore(),
          formatYesNoAnswer(Math.random() < 0.6),
          getRandomScore(),
          formatYesNoAnswer(Math.random() > 0.8),
          getRandomScore(),
          formatYesNoAnswer(Math.random() < 0.75),
          getRandomScore(),
          formatYesNoAnswer(Math.random() < 0.65)
      ];
  }

  // 格式化是否答案
  function formatYesNoAnswer(isYes) {
      return { 
          score: isYes ? "Yes" : "No",
          text: isYes ? "Yes" : "No",
          class: isYes ? "text-green-600" : "text-red-500"
      };
  }

  // 生成 2025 年 4 月的所有日期資料
  const mockData = {
      "James Wilson": {},
      "Oliver Thompson": {},
      "William Parker": {}
  };

  // 生成所有日期的資料
  for (let day = 1; day <= 30; day++) {
      const date = `2025-04-${day.toString().padStart(2, '0')}`;
      
      ["James Wilson", "Oliver Thompson", "William Parker"].forEach(patient => {
          mockData[patient][date] = {
              supportWorker: getConsistentSupportWorker(date, patient),
              answers: generateDailyAnswers(date, patient)
          };
      });
  }

  // 更新表格顯示函數
  function updateReport() {
      const date = document.getElementById('reportDate').value;
      const patient = document.getElementById('patientSelect').value;
      const data = mockData[patient]?.[date];
      
      if (data) {
          document.getElementById('supportWorkerName').textContent = data.supportWorker;
          
          const tbody = document.getElementById('reportTableBody');
          tbody.innerHTML = questions.map((question, index) => {
              const answer = data.answers[index];
              return `
                  <tr class="hover:bg-gray-50">
                      <td class="border-b border-gray-300 px-6 py-4 text-base text-center text-gray-600 whitespace-nowrap">${index + 1}</td>
                      <td class="border-b border-gray-300 px-6 py-4 text-base text-left text-gray-800">${question}</td>
                      <td class="border-b border-gray-300 px-6 py-4">
                          <div class="flex justify-center">
                              <span class="${answer.class} text-base font-semibold">${answer.text}</span>
                          </div>
                      </td>
                  </tr>
              `;
          }).join('');
      } else {
          document.getElementById('supportWorkerName').textContent = 'No Data';
          document.getElementById('reportTableBody').innerHTML = `
              <tr>
                  <td colspan="3" class="text-center py-6 text-gray-500 bg-gray-50">
                      No report history for this date
                  </td>
              </tr>
          `;
      }
  }

  // 初始化頁面
  document.addEventListener('DOMContentLoaded', function() {
      // 設置預設日期為 2025 年 4 月 1 日
      document.getElementById('reportDate').value = '2025-04-01';
      
      // 初始化表格
      updateReport();
      
      // 添加事件監聽器
      document.getElementById('reportDate').addEventListener('change', updateReport);
      document.getElementById('patientSelect').addEventListener('change', updateReport);
  });
</script>
<script>
  function validateForm() {
  const form = document.getElementById('daily-form');
  const inputs = form.querySelectorAll('select, input[type="number"]');
  for (let input of inputs) {
    if (!input.value) {
      alert("Please complete all questions before submitting.");
      input.focus();
      return false;
    }
  }
  return true;
}
</script>
{% endblock %}
