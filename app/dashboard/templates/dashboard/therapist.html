{% extends "base.html" %}

{% block content %}
<div class="min-h-screen flex flex-col">
  <div class="flex flex-1">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-100 p-6 border-r">
    <h2 class="text-xl font-bold mb-6">Physiotherapist</h2>
    <ul id="sidebarLinks" class="space-y-4 text-gray-700">
      <li><a href="#profile" class="sidebar-link text-indigo-700 font-semibold">Profile</a></li>
      <li><a href="#patient-info" class="sidebar-link hover:underline">Patient Info</a></li>
      <li><a href="#schedule" class="sidebar-link hover:underline">Care Schedule</a></li>
      <li><a href="#support-plan" class="sidebar-link hover:underline">Support Plan</a></li>
      <li><a href="#report-record" class="sidebar-link hover:underline">Report Record</a></li>
      <li><a href="#analysis" class="sidebar-link hover:underline">Data Analysis</a></li>
      <li><a href="#share" class="sidebar-link hover:underline">Data Sharing</a></li>
    </ul>
  </aside>

<!-- Right Content Wrapper -->
<div class="flex-1 flex flex-col">
  <main class="p-8 flex-1">
   <!-- Profile Section -->
<section id="profile" class="content-section">
    <!-- Personal Information Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
      <h3 class="text-xl font-bold mb-4">Personal Information</h3>
      <div class="flex items-center gap-8 mb-6 relative">
        <div class="w-40 h-40">
          <img src="{{ url_for('static', filename='images/therapist_photo.jpg') }}" 
               alt="Physiotherapist Photo" 
               class="w-full h-full object-cover rounded-full border-4 border-indigo-500">
        </div>
        <div class="grid grid-cols-1 gap-2 text-gray-800">
          <p><strong>Name:</strong> Dr. Zhang Wei</p>
          <p><strong>Email:</strong> physio@example.com</p>
          <p><strong>Phone:</strong> 0412-345-678</p>
          <p><strong>Position:</strong> Chief Physiotherapist</p>
          <p><strong>Specialty:</strong> Rehabilitation & Mobility Recovery</p>
        </div>
        <p class="absolute bottom-0 right-0 text-xs text-gray-500">Account Created: 2024-03-15</p>
      </div>
    </div>

    <!-- Clinical Strengths Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
      <h4 class="text-xl font-bold mb-4">Clinical Strengths</h4>
      <ul class="list-disc pl-6 text-gray-700">
        <li>Post-surgery physical recovery</li>
        <li>Spine & joint rehabilitation</li>
        <li>Chronic pain management</li>
        <li>Strength training after stroke</li>
      </ul>
    </div>

    <!-- Education Card -->
    <div class="bg-white rounded-lg shadow p-6 mb-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
      <h4 class="text-xl font-bold mb-4">Education</h4>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>2010 – Bachelor of Nursing, University of Sydney</li>
        <li>2012 – Master of Nursing (Clinical Leadership), University of Melbourne</li>
      </ul>
    </div>

    <!-- Work Experience Card -->
    <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
      <h4 class="text-xl font-bold mb-4">Work Experience</h4>
      <ul class="list-disc pl-6 text-gray-700 space-y-1">
        <li>2012–2015: Registered Nurse, Royal Melbourne Hospital</li>
        <li>2015–2018: Senior Nurse, Royal Melbourne Hospital</li>
        <li>2018–Present: Head of Physiotherapy Department</li>
      </ul>
    </div>
</section>

   <!-- Patient Information Section -->
<section id="patient-info" class="content-section hidden mb-8">
  <!-- Patient 1 Card -->
  <div class="bg-white rounded-lg shadow p-6 mb-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <div class="flex gap-8">
      <div class="w-48 h-48">
        <img src="{{ url_for('static', filename='images/patient_photo.jpg') }}" 
             alt="Patient Photo" 
             class="w-full h-full object-cover rounded-lg border-4 border-indigo-500">
      </div>
      <div class="flex-1 space-y-4">
        <div class="pb-4">
          <h4 class="font-semibold mb-2">Basic Details</h4>
          <p class="text-gray-600">Name: <span class="text-gray-800">Li Dahua</span></p>
          <p class="text-gray-600">Patient ID: <span class="text-gray-800">PT20240315001</span></p>
          <p class="text-gray-600">Insurance Number: <span class="text-gray-800">A123456789</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Patient 2 Card -->
  <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <div class="flex gap-8">
      <div class="w-48 h-48">
        <img src="{{ url_for('static', filename='images/patient_photo.jpg') }}" 
             alt="Patient Photo" 
             class="w-full h-full object-cover rounded-lg border-4 border-indigo-500">
      </div>
      <div class="flex-1 space-y-4">
        <div class="pb-4">
          <h4 class="font-semibold mb-2">Basic Details</h4>
          <p class="text-gray-600">Name: <span class="text-gray-800">Zhao Wu</span></p>
          <p class="text-gray-600">Patient ID: <span class="text-gray-800">PT20240315002</span></p>
          <p class="text-gray-600">Insurance Number: <span class="text-gray-800">B987654321</span></p>
        </div>
      </div>
    </div>
  </div>
</section>

    <!-- Care Schedule Section -->
<section id="schedule" class="content-section hidden">
  <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <h3 class="text-xl font-bold mb-4">Care Schedule</h3>
    <table class="w-full border-collapse border border-gray-300">
      <thead>
        <tr class="bg-gray-100">
          <th class="border border-gray-300 px-4 py-2 font-bold">Time</th>
          <th class="border border-gray-300 px-4 py-2 font-bold">Activity</th>
          <th class="border border-gray-300 px-4 py-2 font-bold">Assigned Staff</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="border border-gray-300 px-4 py-2">09:00</td>
          <td class="border border-gray-300 px-4 py-2">Morning Care</td>
          <td class="border border-gray-300 px-4 py-2">Nurse Ms. Chen</td>
        </tr>
        <tr>
          <td class="border border-gray-300 px-4 py-2">14:00</td>
          <td class="border border-gray-300 px-4 py-2">Rehabilitation Exercise</td>
          <td class="border border-gray-300 px-4 py-2">Physiotherapist Mr. Lin</td>
        </tr>
        <tr>
          <td class="border border-gray-300 px-4 py-2">19:00</td>
          <td class="border border-gray-300 px-4 py-2">Evening Care</td>
          <td class="border border-gray-300 px-4 py-2">Nurse Ms. Wang</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

    <!-- Support Plan Section -->
<section id="support-plan" class="content-section hidden">
    <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
      <h3 class="text-xl font-bold mb-6">Support Plan</h3>
  
      <!-- Patient and Date Selection -->
      <div class="grid grid-cols-2 gap-4 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
          <select id="patient-select" class="w-full border rounded-md px-3 py-2">
            <option value="">-- Select Patient --</option>
            <option value="Zhao Wu">Zhao Wu</option>
            <option value="Li Dahua">Li Dahua</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
          <input type="date" id="plan-date" class="w-full border rounded-md px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Valid Until</label>
          <input type="date" id="valid-until" class="w-full border rounded-md px-3 py-2" />
        </div>
      </div>
  
      <!-- Auto-Fill Patient Info -->
      <div id="patient-info" class="bg-gray-50 p-4 rounded space-y-2 text-sm text-gray-800 hidden">
        <h4 class="font-semibold text-base mb-2">Patient Basic Information</h4>
        <p id="patient-name"></p>
        <p id="patient-id"></p>
        <p id="patient-gender"></p>
        <p id="patient-age"></p>
      </div>
  
      <!-- Fillable Sections -->
      <div class="space-y-6 mt-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Rehabilitation Goals</label>
          <textarea id="goals" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Therapy Recommendations</label>
          <textarea id="therapy" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Daily Living Assistance</label>
          <textarea id="assistance" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Data Tracking Focus</label>
          <textarea id="tracking" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Exercise Prescription Library</label>
          <textarea id="exercise" rows="3" class="w-full border rounded-md px-3 py-2"></textarea>
        </div>
      </div>
  
      <!-- Preview and Submit -->
      <div class="mt-8">
        <h4 class="text-lg font-bold mb-4">Summary Preview</h4>
        <div id="summary" class="bg-gray-100 p-4 rounded space-y-3 text-sm"></div>
        <button id="submit-plan" class="mt-6 bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">Send to Guardian</button>
      </div>
    </div>
  </section>
  
  <script>
    // Patient info database
    const patients = {
      'Zhao Wu': { id: 'PT20240315002', gender: 'Male', age: 65 },
      'Li Dahua': { id: 'PT20240315003', gender: 'Female', age: 70 }
    };
  
    document.getElementById('patient-select').addEventListener('change', function() {
      const selected = this.value;
      const infoDiv = document.getElementById('patient-info');
      if (patients[selected]) {
        infoDiv.classList.remove('hidden');
        document.getElementById('patient-name').innerText = `Name: ${selected}`;
        document.getElementById('patient-id').innerText = `Patient ID: ${patients[selected].id}`;
        document.getElementById('patient-gender').innerText = `Gender: ${patients[selected].gender}`;
        document.getElementById('patient-age').innerText = `Age: ${patients[selected].age}`;
      } else {
        infoDiv.classList.add('hidden');
      }
    });
  
    document.getElementById('submit-plan').addEventListener('click', function() {
      const patient = document.getElementById('patient-select').value;
      const date = document.getElementById('plan-date').value;
      const validUntil = document.getElementById('valid-until').value;
      const goals = document.getElementById('goals').value;
      const therapy = document.getElementById('therapy').value;
      const assistance = document.getElementById('assistance').value;
      const tracking = document.getElementById('tracking').value;
      const exercise = document.getElementById('exercise').value;
  
      const summaryDiv = document.getElementById('summary');
      summaryDiv.innerHTML = `
        <p><strong>Patient:</strong> ${patient}</p>
        <p><strong>Date:</strong> ${date}</p>
        <p><strong>Valid Until:</strong> ${validUntil}</p>
        <p><strong>Rehabilitation Goals:</strong><br>${goals.replace(/\n/g, '<br>')}</p>
        <p><strong>Therapy Recommendations:</strong><br>${therapy.replace(/\n/g, '<br>')}</p>
        <p><strong>Daily Living Assistance:</strong><br>${assistance.replace(/\n/g, '<br>')}</p>
        <p><strong>Data Tracking Focus:</strong><br>${tracking.replace(/\n/g, '<br>')}</p>
        <p><strong>Exercise Prescription Library:</strong><br>${exercise.replace(/\n/g, '<br>')}</p>
      `;
  
      // 這裡可以加一個真正"發送給Guardian"的後端接口調用，例如fetch API，這裡暫時只是Preview
    });
  </script>

    <!-- Report Record Section -->
<section id="report-record" class="content-section hidden">
<div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
<h3 class="text-xl font-bold mb-6">Patient History</h3>
<!-- Selection Area -->
<div class="grid grid-cols-2 gap-6 mb-8">
  <div class="bg-gray-50 rounded-lg p-4">
    <div class="flex justify-between items-center mb-3">
      <span class="font-medium text-gray-700">Report Date:</span>
      <input class="border rounded-md px-3 py-1.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" id="reportDate" type="date"/>
    </div>
    <div class="flex justify-between items-center">
      <span class="font-medium text-gray-700">Support Worker:</span>
      <span class="text-gray-900 font-medium" id="supportWorkerName">No Data</span>
    </div>
  </div>
  <div class="bg-gray-50 rounded-lg p-4">
    <div class="flex justify-between items-center">
      <span class="font-medium text-gray-700">Patient Name:</span>
      <select class="border rounded-md px-3 py-1.5 bg-white w-48 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" id="patientSelect">
        <option value="James Wilson">James Wilson</option>
        <option value="Oliver Thompson">Oliver Thompson</option>
        <option value="William Parker">William Parker</option>
      </select>
    </div>
  </div>
</div>
<!-- Table Area -->
<div class="overflow-hidden rounded-lg border border-gray-200">
  <table class="w-full border-collapse">
    <thead>
      <tr class="bg-gray-100">
        <th class="text-gray-800 align-middle text-sm w-12 py-3 px-4 text-center font-semibold border-gray-200 border-b whitespace-nowrap">No.</th>
        <th class="border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-left">Question</th>
        <th class="w-48 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-center">Answer</th>
      </tr>
    </thead>
    <tbody id="reportTableBody">
    </tbody>
  </table>
</div>
</div>
</section>

   <!-- Data Analysis Section -->
<section id="analysis" class="content-section hidden">
  <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <h3 class="text-xl font-bold mb-6">Data Analysis</h3>

    <!-- Patient Selector -->
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
        <select class="w-full border rounded-md px-3 py-2">
          <option>All</option>
          <option>Zhao Wu</option>
          <option>Li Dahua</option>
        </select>
      </div>
      <div class="flex items-end justify-end">
        <button class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Download Data</button>
      </div>
    </div>

    <!-- Chart Area -->
    <div class="grid grid-cols-2 gap-6 mb-8">
      <div>
        <h4 class="font-semibold mb-2">Weekly Progress Chart</h4>
        <canvas id="weeklyChart" class="w-full h-64 bg-white border rounded"></canvas>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Monthly Statistics Chart</h4>
        <canvas id="monthlyChart" class="w-full h-64 bg-white border rounded"></canvas>
      </div>
    </div>

    <!-- 引入 Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Weekly Progress Chart
      const ctxWeekly = document.getElementById('weeklyChart').getContext('2d');
      const weeklyChart = new Chart(ctxWeekly, {
        type: 'line',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Step Count',
            data: [3000, 5000, 5200, 4800, 5200, 5800, 6000],
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 2,
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Monthly Statistics Chart
      const ctxMonthly = document.getElementById('monthlyChart').getContext('2d');
      const monthlyChart = new Chart(ctxMonthly, {
        type: 'bar',
        data: {
          labels: ['Hip', 'Knee', 'Ankle'],
          datasets: [{
            label: 'Range of Motion',
            data: [110, 140, 70],
            backgroundColor: 'rgba(34, 197, 94, 0.5)',
            borderColor: 'rgba(34, 197, 94, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    </script>

    <!-- Rehab Progress Tracker -->
    <div class="mt-8">
      <h4 class="text-lg font-semibold mb-4 text-indigo-700">Rehab Progress Tracker</h4>
      <div class="grid grid-cols-3 gap-6">
        <div>
          <h5 class="font-medium mb-2">Step Count</h5>
          <canvas id="stepsChart" class="w-full h-56 bg-white border rounded"></canvas>
        </div>
        <div>
          <h5 class="font-medium mb-2">Range of Motion</h5>
          <canvas id="romChart" class="w-full h-56 bg-white border rounded"></canvas>
        </div>
        <div>
          <h5 class="font-medium mb-2">Muscle Strength</h5>
          <canvas id="strengthChart" class="w-full h-56 bg-white border rounded"></canvas>
        </div>
      </div>
    </div>
  </div>
</section>

   <!-- Data Sharing Section -->
<section id="share" class="content-section hidden">
  <div class="bg-white rounded-lg shadow p-6 transition duration-300 ease-in-out hover:shadow-lg hover:scale-[1.01]">
    <h3 class="text-xl font-bold mb-6">Data Sharing</h3>

    <!-- Share Form -->
    <div class="space-y-6 mb-8">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Patient</label>
        <select class="w-full border rounded px-3 py-2">
          <option>Chen Er</option>
          <option>Zhao Wu</option>
          <option>Li Dahua</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Data to Share</label>
        <select multiple class="w-full border rounded px-3 py-2 h-32">
          <option>Line Chart</option>
          <option>Bar Chart</option>
          <option>Heatmap</option>
          <option>Support Plan</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Select Recipient</label>
        <select class="w-full border rounded px-3 py-2">
          <option>Dr. Li - Psychotherapist</option>
          <option>Dr. Wang - Occupational Therapist</option>
          <option>Dr. Chen - Supervisor</option>
        </select>
      </div>

      <div class="flex justify-center gap-6 mt-4">
        <button class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">Share</button>
        <button class="bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700">Download</button>
      </div>
    </div>

    <!-- Sharing History -->
    <div class="grid grid-cols-2 gap-6">
      <!-- Shared By Me -->
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition duration-300">
        <h4 class="font-semibold mb-2">Patients I Shared</h4>
        <div class="border rounded p-4 bg-gray-50 text-sm text-gray-700 space-y-2">
          <p>Chen Er – Line Chart, Support Plan (to Dr. Li)</p>
          <p>Zhao Wu – Heatmap (to Dr. Wang)</p>
        </div>
      </div>

      <!-- Shared With Me -->
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition duration-300">
        <h4 class="font-semibold mb-2">Shared With Me</h4>
        <div class="border rounded p-4 bg-gray-50 text-sm text-gray-700 space-y-2">
          <p>Liu Yi – Line Chart (from Dr. Li)</p>
          <p>Wang Fang – Bar Chart, Support Plan (from Dr. Wang)</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- JS for Sidebar Highlighting and Section Switching -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const links = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('main section');

    links.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);

        sections.forEach(section => {
          section.classList.add('hidden');
          if (section.id === targetId) {
            section.classList.remove('hidden');
          }
        });

        links.forEach(l => l.classList.remove('text-indigo-700', 'font-semibold'));
        this.classList.add('text-indigo-700', 'font-semibold');
      });
    });
  });
</script>

<!-- JS for Forms and Charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const links = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('main section');

    links.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);

        sections.forEach(section => {
          section.classList.add('hidden');
          if (section.id === targetId) {
            section.classList.remove('hidden');
          }
        });

        links.forEach(l => l.classList.remove('text-indigo-700', 'font-semibold'));
        this.classList.add('text-indigo-700', 'font-semibold');
      });
    });

    // Rehab Progress Tracker charts
    const stepsCtx = document.getElementById('stepsChart').getContext('2d');
    const romCtx = document.getElementById('romChart').getContext('2d');
    const strengthCtx = document.getElementById('strengthChart').getContext('2d');

    new Chart(stepsCtx, {
      type: 'line',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
        datasets: [{
          label: 'Daily Steps',
          data: [3200, 4500, 5000, 3900, 4700, 5100, 5600],
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99, 102, 241, 0.1)',
          borderWidth: 2,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false }},
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    new Chart(romCtx, {
      type: 'bar',
      data: {
        labels: ['Hip', 'Knee', 'Ankle'],
        datasets: [{
          label: 'ROM (°)',
          data: [110, 135, 70],
          backgroundColor: '#34d399',
          borderRadius: 4
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false }},
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    new Chart(strengthCtx, {
      type: 'radar',
      data: {
        labels: ['Quadriceps', 'Hamstrings', 'Calf'],
        datasets: [{
          label: 'Strength (1–5)',
          data: [4, 3, 5],
          backgroundColor: 'rgba(239, 68, 68, 0.2)',
          borderColor: '#ef4444',
          borderWidth: 2,
          pointBackgroundColor: '#ef4444'
        }]
      },
      options: {
        responsive: true,
        elements: { line: { tension: 0.2 } },
        scales: {
          r: {
            min: 0,
            max: 5,
            ticks: { stepSize: 1 }
          }
        }
      }
    });

  });
</script>

<!-- Add this JavaScript code before the closing </script> tag -->
<script>
// 定義問題列表
const questions = [
    "How is the patient's mental status today?",
    "Did the patient take their medication on time?",
    "Food intake score",
    "Did the patient complete today's rehabilitation activity?",
    "Sleep quality score",
    "Any abnormal symptoms?",
    "Emotional stability score",
    "Did the patient follow the doctor's instructions?",
    "Activity participation score",
    "Any social interaction?"
];

// 定義可用的 Support Worker 列表
const supportWorkers = ["Michael Smith", "George Davies", "Emma Taylor"];

// 使用日期和病患名作為 key 來確保同一天同一個病患對應到同一個 Support Worker
function getConsistentSupportWorker(date, patient) {
    const seed = date + patient;
    let hash = 0;
    for (let i = 0; i < seed.length; i++) {
        hash = ((hash << 5) - hash) + seed.charCodeAt(i);
        hash = hash & hash;
    }
    return supportWorkers[Math.abs(hash) % supportWorkers.length];
}

// 修改生成答案的部分
function generateDailyAnswers(date, patient) {
    // 評分對應設定
    const ratings = {
        1: { text: "Poor", class: "text-red-500" },
        3: { text: "Average", class: "text-yellow-600" },
        5: { text: "Good", class: "text-green-600" }
    };

    // 生成評分答案
    function getRandomScore() {
        const scores = [1, 3, 5];
        const score = scores[Math.floor(Math.random() * 3)];
        return { 
            score: score.toString(),
            text: ratings[score].text,
            class: ratings[score].class
        };
    }

    return [
        getRandomScore(),
        formatYesNoAnswer(Math.random() < 0.7),
        getRandomScore(),
        formatYesNoAnswer(Math.random() < 0.6),
        getRandomScore(),
        formatYesNoAnswer(Math.random() > 0.8),
        getRandomScore(),
        formatYesNoAnswer(Math.random() < 0.75),
        getRandomScore(),
        formatYesNoAnswer(Math.random() < 0.65)
    ];
}

// 格式化是否答案
function formatYesNoAnswer(isYes) {
    return { 
        score: isYes ? "Yes" : "No",
        text: isYes ? "Yes" : "No",
        class: isYes ? "text-green-600" : "text-red-500"
    };
}

// 生成 2025 年 4 月的所有日期資料
const mockData = {
    "James Wilson": {},
    "Oliver Thompson": {},
    "William Parker": {}
};

// 生成所有日期的資料
for (let day = 1; day <= 30; day++) {
    const date = `2025-04-${day.toString().padStart(2, '0')}`;
    
    ["James Wilson", "Oliver Thompson", "William Parker"].forEach(patient => {
        mockData[patient][date] = {
            supportWorker: getConsistentSupportWorker(date, patient),
            answers: generateDailyAnswers(date, patient)
        };
    });
}

// 更新表格顯示函數
function updateReport() {
    const date = document.getElementById('reportDate').value;
    const patient = document.getElementById('patientSelect').value;
    const data = mockData[patient]?.[date];
    
    if (data) {
        document.getElementById('supportWorkerName').textContent = data.supportWorker;
        
        const tbody = document.getElementById('reportTableBody');
        tbody.innerHTML = questions.map((question, index) => {
            const answer = data.answers[index];
            return `
                <tr class="hover:bg-gray-50">
                    <td class="border-b border-gray-300 px-6 py-4 text-base text-center text-gray-600 whitespace-nowrap">${index + 1}</td>
                    <td class="border-b border-gray-300 px-6 py-4 text-base text-left text-gray-800">${question}</td>
                    <td class="border-b border-gray-300 px-6 py-4">
                        <div class="flex justify-center">
                            <span class="${answer.class} text-base font-semibold">${answer.text}</span>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    } else {
        document.getElementById('supportWorkerName').textContent = 'No Data';
        document.getElementById('reportTableBody').innerHTML = `
            <tr>
                <td colspan="3" class="text-center py-6 text-gray-500 bg-gray-50">
                    No report history for this date
                </td>
            </tr>
        `;
    }
}

// 初始化頁面
document.addEventListener('DOMContentLoaded', function() {
    // 設置預設日期為 2025 年 4 月 1 日
    document.getElementById('reportDate').value = '2025-04-01';
    
    // 初始化表格
    updateReport();
    
    // 添加事件監聽器
    document.getElementById('reportDate').addEventListener('change', updateReport);
    document.getElementById('patientSelect').addEventListener('change', updateReport);
});
</script>
{% endblock %}
