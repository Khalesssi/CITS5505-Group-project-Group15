{% extends "base.html" %}

{% block content %}
<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-gray-100 p-6 border-r">
    <h2 class="text-xl font-bold mb-6">Supervisor</h2>
    <ul id="sidebarLinks" class="space-y-4 text-gray-700">
      <li><a href="#profile" class="sidebar-link text-indigo-700 font-semibold">Profile</a></li>
      <li><a href="#assign" class="sidebar-link hover:underline">Schedule Assignment</a></li>
      <li><a href="#schedule" class="sidebar-link hover:underline">Current Schedule</a></li>
      <li><a href="#reports" class="sidebar-link hover:underline">Report Records</a></li>
      <li><a href="#analysis" class="sidebar-link hover:underline">Data Analysis</a></li>
      <li><a href="#overview" class="sidebar-link hover:underline">Support Worker Overview</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-8">
    <!-- Profile Section -->
    <section id="profile" class="content-section space-y-6">
      <!-- Profile Card -->
      <div class="bg-white rounded-lg shadow p-6 relative hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-4">Profile</h3>
        <div class="flex items-center gap-8 mb-6">
          <div class="w-40 h-40">
            <img src="{{ url_for('static', filename='images/supervisor_avatar.jpg') }}" 
                 alt="Supervisor Photo" 
                 class="w-full h-full object-cover rounded-full border-4 border-indigo-500">
          </div>
          <div class="grid grid-cols-1 gap-4">
            <div>
              <p class="text-gray-600">Name: <span class="text-gray-800">Director Chen</span></p>
              <p class="text-gray-600">Email: <span class="text-gray-800">supervisor@example.com</span></p>
              <p class="text-gray-600">Position: <span class="text-gray-800">Head of Nursing Department</span></p>
            </div>
          </div>
          <p class="absolute bottom-0 right-0 p-6 text-xs text-gray-500">Account Created: 2024-03-15</p>
        </div>
      </div>

      <!-- Education Card -->
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-4">Education</h3>
        <ul class="list-disc list-inside text-gray-600 space-y-2">
          <li>2010 - Bachelor of Nursing, National Taiwan University</li>
          <li>2012 - Master of Nursing, Yangming University</li>
        </ul>
      </div>

      <!-- Work Experience Card -->
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-4">Work Experience</h3>
        <ul class="list-disc list-inside text-gray-600 space-y-2">
          <li>2012-2015 Nurse, NTU Hospital</li>
          <li>2015-2018 Head Nurse, NTU Hospital</li>
          <li>2018-Present Head of Nursing Department</li>
        </ul>
      </div>
    </section>
    
    <!-- Shift Assignment Section -->
    <section id="assign" class="content-section hidden">
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-6">Shift Assignment</h3>
        
        <!-- Assignment Settings Block -->
        <div class="bg-gray-50 rounded-lg p-6 mb-6">
          <h4 class="text-lg font-semibold mb-4">Assignment Settings</h4>
          
          <!-- Form Fields -->
          <div class="space-y-6">  <!-- Add spacing between fields -->
            <!-- Support Worker Name -->
            <div class="w-full">
              <label class="block text-base font-bold text-gray-700 mb-3">
                Support Worker Name
              </label>
              <select class="w-full border rounded-md px-4 py-2.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option>Please select a support worker</option>
                <option>Ms. Zhang</option>
                <option>Ms. Wang</option>
              </select>
            </div>
    
            <!-- Patient -->
            <div class="w-full">
              <label class="block text-base font-bold text-gray-700 mb-3">
                Patient
              </label>
              <select class="w-full border rounded-md px-4 py-2.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option>Please select a patient</option>
                <option>David Lee</option>
                <option>Xiaoming Wang</option>
              </select>
            </div>
    
            <!-- Shift Time -->
            <div class="w-full">
              <label class="block text-base font-bold text-gray-700 mb-3">
                Shift Time
              </label>
              <select class="w-full border rounded-md px-4 py-2.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option>Please select a time slot</option>
                <option>Morning Shift (08:00–16:00)</option>
                <option>Afternoon Shift (16:00–24:00)</option>
                <option>Night Shift (00:00–08:00)</option>
              </select>
            </div>
          </div>
        </div>
    
        <!-- Assign Button Area -->
        <div class="flex justify-end mt-8">  <!-- Add spacing from the block above -->
          <button class="bg-indigo-600 text-white px-8 py-3 rounded-md hover:bg-indigo-700 hover:shadow-md transform hover:-translate-y-0.5 transition-all duration-200">
            Assign
          </button>
        </div>
      </div>
    </section>
    
    <!-- Current Schedule Section -->
    <section id="schedule" class="content-section hidden">
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-6">Current Schedule</h3>
    
        <!-- Top Control Bar -->
        <div class="flex items-center justify-between mb-6 gap-4">
          <!-- Date Picker -->
          <div class="flex items-center gap-4">
            <div class="relative">
              <input type="date" 
                     class="border rounded-md px-4 py-2 pr-8 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                     value="2024-03-15">
            </div>
          </div>
    
          <!-- Support Worker Search -->
          <div class="relative flex-1 max-w-md">
            <input type="text" 
                   placeholder="Search support worker..." 
                   class="w-full border rounded-md pl-10 pr-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
        </div>
    
        <!-- Main Table Content -->
        <div class="overflow-x-auto">
          <table class="w-full border-collapse">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Date</th>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Shift</th>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Support Worker</th>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Task</th>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Status</th>
                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <!-- Row 1 -->
              <tr class="hover:bg-gray-50 transition-colors duration-200">
                <td class="px-4 py-4 text-sm text-gray-700">2024-03-15</td>
                <td class="px-4 py-4 text-sm text-gray-700">Morning</td>
                <td class="px-4 py-4">
                  <div class="flex items-center gap-3">
                    <img class="h-8 w-8 rounded-full" src="{{ url_for('static', filename='images/avatar1.jpg') }}" alt="Support Worker Avatar">
                    <span class="text-sm text-gray-700">Ms. Zhang</span>
                  </div>
                </td>
                <td class="px-4 py-4 text-sm text-gray-700">Care for David Lee</td>
                <td class="px-4 py-4">
                  <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-medium">
                    In Progress
                  </span>
                </td>
                <td class="px-4 py-4">
                  <button class="bg-red-50 text-red-600 hover:bg-red-100 px-3 py-1.5 rounded-md text-sm font-medium transition-colors duration-200">
                    Cancel
                  </button>
                </td>
              </tr>
    
              <!-- Row 2 -->
              <tr class="hover:bg-gray-50 transition-colors duration-200">
                <td class="px-4 py-4 text-sm text-gray-700">2024-03-15</td>
                <td class="px-4 py-4 text-sm text-gray-700">Afternoon</td>
                <td class="px-4 py-4">
                  <div class="flex items-center gap-3">
                    <img class="h-8 w-8 rounded-full" src="{{ url_for('static', filename='images/avatar2.jpg') }}" alt="Support Worker Avatar">
                    <span class="text-sm text-gray-700">Ms. Wang</span>
                  </div>
                </td>
                <td class="px-4 py-4 text-sm text-gray-700">Care for Xiaoming Wang</td>
                <td class="px-4 py-4">
                  <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-medium">
                    Completed
                  </span>
                </td>
                <td class="px-4 py-4">
                  <button class="bg-red-50 text-red-600 hover:bg-red-100 px-3 py-1.5 rounded-md text-sm font-medium transition-colors duration-200">
                    Cancel
                  </button>
                </td>
              </tr>
    
              <!-- Row 3 -->
              <tr class="hover:bg-gray-50 transition-colors duration-200">
                <td class="px-4 py-4 text-sm text-gray-700">2024-03-14</td>
                <td class="px-4 py-4 text-sm text-gray-700">Night</td>
                <td class="px-4 py-4">
                  <div class="flex items-center gap-3">
                    <img class="h-8 w-8 rounded-full" src="{{ url_for('static', filename='images/avatar3.jpg') }}" alt="Support Worker Avatar">
                    <span class="text-sm text-gray-700">Ms. Li</span>
                  </div>
                </td>
                <td class="px-4 py-4 text-sm text-gray-700">Care for Daming Zhang</td>
                <td class="px-4 py-4">
                  <span class="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs font-medium">
                    Cancelled
                  </span>
                </td>
                <td class="px-4 py-4">
                  <button disabled class="bg-gray-50 text-gray-400 cursor-not-allowed px-3 py-1.5 rounded-md text-sm font-medium">
                    Cancel
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Report Records Viewing Interface -->
    <section id="reports" class="content-section hidden">
      <div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6">
        <h3 class="text-xl font-bold mb-6">Report Records</h3>
        
        <!-- Info Section - Two-column grid layout -->
        <div class="grid grid-cols-2 gap-6 mb-8">
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center mb-3">
              <span class="font-medium text-gray-700">Report Date:</span>
              <input type="date" 
                     id="reportDate"
                     class="border rounded-md px-3 py-1.5 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div class="flex justify-between items-center">
              <span class="font-medium text-gray-700">Support Worker:</span>
              <span id="supportWorkerName" class="text-gray-900 font-medium">Chen Xiaoming</span>
            </div>
          </div>
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="font-medium text-gray-700">Patient Name:</span>
              <select id="patientSelect" 
                      class="border rounded-md px-3 py-1.5 bg-white w-48 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option value="李大華">David Lee</option>
                <option value="張小明">Xiaoming Zhang</option>
                <option value="王大明">Daming Wang</option>
              </select>
            </div>
          </div>
        </div>
    
        <!-- Report Record Table -->
        <div class="overflow-hidden rounded-lg border border-gray-200">
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-100">
                <th class="w-12 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-center">#</th>
                <th class="border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-left">Question</th>
                <th class="w-48 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-800 text-center">Answer</th>
              </tr>
            </thead>
            <tbody id="reportTableBody">
              <!-- Dynamically generated content -->
            </tbody>
          </table>
        </div>
      </div>
    </section>
   
    <!-- Data Analysis Section -->
    <section id="analysis" class="content-section hidden">
      <div class="bg-white rounded-lg shadow p-6 hover:shadow-lg transition-shadow duration-300">
        <h3 class="text-xl font-bold mb-4">Data Analysis</h3>
        <div class="grid grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold mb-2">Weekly Data Chart</h4>
            <canvas id="weeklyChart" class="w-full"></canvas>
          </div>
          <div>
            <h4 class="font-semibold mb-2">Monthly Statistics</h4>
            <canvas id="monthlyChart" class="w-full"></canvas>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Support Worker Overview Page -->
    <section id="overview" class="content-section">
      <div class="container mx-auto px-4 py-6">
        <h2 class="text-2xl font-bold mb-6">Management Overview</h2>
    
        <!-- Statistics Cards Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
          <!-- Total Number of Support Workers -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-blue-100 mr-4">
                <i class="fas fa-users text-blue-500"></i>
              </div>
              <div>
                <h3 class="text-gray-500 text-sm">Total Support Workers</h3>
                <p class="text-2xl font-bold">4</p>
              </div>
            </div>
          </div>
    
          <!-- Active Staff -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-green-100 mr-4">
                <i class="fas fa-user-check text-green-500"></i>
              </div>
              <div>
                <h3 class="text-gray-500 text-sm">Currently Active</h3>
                <p class="text-2xl font-bold">4</p>
              </div>
            </div>
          </div>
    
          <!-- Staff on Leave -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
              <div class="p-3 rounded-full bg-yellow-100 mr-4">
                <i class="fas fa-user-clock text-yellow-500"></i>
              </div>
              <div>
                <h3 class="text-gray-500 text-sm">On Leave</h3>
                <p class="text-2xl font-bold">0</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Support Worker List -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
      <div class="p-6">
        <h3 class="text-xl font-semibold mb-4">Support Worker Status</h3>
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="bg-gray-50">
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Attendance</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Patients This Month</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <!-- Chen Xiaoming -->
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900">Chen Xiaoming</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Active
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="w-16 h-16 relative">
                      <svg class="w-16 h-16 transform -rotate-90">
                        <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" />
                        <circle class="text-red-500" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" stroke-dasharray="150.79644737231007" stroke-dashoffset="22.619467105846510" />
                      </svg>
                      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <span class="text-sm font-semibold text-red-500">85%</span>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">3</td>
              </tr>
    
              <!-- Wang Xiaohua -->
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900">Wang Xiaohua</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Active
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="w-16 h-16 relative">
                      <svg class="w-16 h-16 transform -rotate-90">
                        <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" />
                        <circle class="text-green-500" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" stroke-dasharray="150.79644737231007" stroke-dashoffset="7.539822368615503" />
                      </svg>
                      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <span class="text-sm font-semibold text-green-500">95%</span>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2</td>
              </tr>
    
              <!-- Lin Meiling -->
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900">Lin Meiling</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Active
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="w-16 h-16 relative">
                      <svg class="w-16 h-16 transform -rotate-90">
                        <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" />
                        <circle class="text-green-500" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" stroke-dasharray="150.79644737231007" stroke-dashoffset="12.063715789784806" />
                      </svg>
                      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <span class="text-sm font-semibold text-green-500">92%</span>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1</td>
              </tr>
    
              <!-- Zhang Zhiming -->
              <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-900">Zhang Zhiming</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Active
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="w-16 h-16 relative">
                      <svg class="w-16 h-16 transform -rotate-90">
                        <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" />
                        <circle class="text-red-500" stroke-width="8" stroke="currentColor" fill="transparent" r="24" cx="32" cy="32" stroke-dasharray="150.79644737231007" stroke-dashoffset="27.143396131815612" />
                      </svg>
                      <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <span class="text-sm font-semibold text-red-500">82%</span>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

<!-- Navigation Script -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const links = document.querySelectorAll('.sidebar-link');
    const sections = document.querySelectorAll('main section');

    links.forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);

        sections.forEach(section => {
          section.classList.add('hidden');
          if (section.id === targetId) {
            section.classList.remove('hidden');
          }
        });

        links.forEach(l => l.classList.remove('text-indigo-700', 'font-semibold'));
        this.classList.add('text-indigo-700', 'font-semibold');
      });
    });
  });

  // Set default date to today
  document.addEventListener('DOMContentLoaded', function() {
    const today = new Date().toISOString().split('T')[0];
    document.querySelector('input[type="date"]').value = today;
  });

  // Update Support Worker when date or patient changes
  document.querySelector('input[type="date"]').addEventListener('change', updateSupportWorker);
  document.querySelector('select').addEventListener('change', updateSupportWorker);

  function updateSupportWorker() {
    // This should fetch corresponding Support Worker info from backend API
    // Currently for demonstration only
    const date = document.querySelector('input[type="date"]').value;
    const patient = document.querySelector('select').value;
    // Update Support Worker display
    // In actual use, this would be an API call
  }
</script>

<script>
const questions = [
  "How is the patient's mental state today?",
  "Did the patient take medication on time?",
  "Eating condition rating",
  "Did the patient complete today's rehab activity?",
  "Sleep quality rating",
  "Any abnormal symptoms?",
  "Emotional stability rating",
  "Did the patient follow medical advice?",
  "Participation in activities rating",
  "Any social interaction?"
];

// Define the available list of Support Workers
const supportWorkers = ["Chen Xiaoming", "Wang Xiaohua", "Lin Meiling", "Zhang Zhiming"];

// Use date + patient name as key to ensure consistent mapping for same date and patient
function getConsistentSupportWorker(date, patient) {
  const seed = date + patient;
  let hash = 0;
  for (let i = 0; i < seed.length; i++) {
    hash = ((hash << 5) - hash) + seed.charCodeAt(i);
    hash = hash & hash;
  }
  return supportWorkers[Math.abs(hash) % supportWorkers.length];
}

// Generate mock answers
function generateDailyAnswers(date, patient) {
  // Rating config
  const ratings = {
    1: { text: "Poor", class: "text-red-500" },
    3: { text: "Average", class: "text-yellow-600" },
    5: { text: "Good", class: "text-green-600" }
  };

  function getRandomScore() {
    const scores = [1, 3, 5];
    const score = scores[Math.floor(Math.random() * 3)];
    return { 
      score: score.toString(),
      text: ratings[score].text,
      class: ratings[score].class
    };
  }

  return [
    getRandomScore(),                             // Mental state
    formatYesNoAnswer(Math.random() < 0.7),       // Took medication
    getRandomScore(),                             // Eating condition
    formatYesNoAnswer(Math.random() < 0.6),       // Rehab
    getRandomScore(),                             // Sleep
    formatYesNoAnswer(Math.random() > 0.8),       // Abnormal symptoms
    getRandomScore(),                             // Emotion
    formatYesNoAnswer(Math.random() < 0.75),      // Follow instructions
    getRandomScore(),                             // Activity
    formatYesNoAnswer(Math.random() < 0.65)       // Social interaction
  ];
}

// Format yes/no answers
function formatYesNoAnswer(isYes) {
  return { 
    score: isYes ? "Yes" : "No",
    text: isYes ? "Yes" : "No",
    class: isYes ? "text-green-600" : "text-red-500"
  };
}

// Generate data for all dates in April 2025
const mockData = {
  "Li Dahua": {},
  "Zhang Xiaoming": {},
  "Wang Daming": {}
};

// Generate records for each date
for (let day = 1; day <= 30; day++) {
  const date = `2025-04-${day.toString().padStart(2, '0')}`;
  ["Li Dahua", "Zhang Xiaoming", "Wang Daming"].forEach(patient => {
    mockData[patient][date] = {
      supportWorker: getConsistentSupportWorker(date, patient),
      answers: generateDailyAnswers(date, patient)
    };
  });
}

// Render update to the table
function updateReport() {
  const date = document.querySelector('#reportDate').value;
  const patient = document.querySelector('#patientSelect').value;

  if (mockData[patient] && mockData[patient][date]) {
    const data = mockData[patient][date];

    // Update Support Worker name
    document.querySelector('#supportWorkerName').textContent = data.supportWorker;

    // Update table
    const tbody = document.querySelector('#reportTableBody');
    tbody.innerHTML = '';

    questions.forEach((question, index) => {
      const answer = data.answers[index];
      const row = document.createElement('tr');
      row.className = 'hover:bg-gray-50 transition-colors duration-150';
      row.innerHTML = `
        <td class="border-b border-gray-200 px-4 py-3 text-center text-gray-600">${index + 1}</td>
        <td class="border-b border-gray-200 px-4 py-3 text-left font-medium text-gray-800">${question}</td>
        <td class="border-b border-gray-200 px-4 py-3">
          <div class="flex justify-center">
            <span class="${answer.class} font-semibold">${answer.text}</span>
          </div>
        </td>
      `;
      tbody.appendChild(row);
    });
  } else {
    // If no data is available
    document.querySelector('#supportWorkerName').textContent = "No Data";
    document.querySelector('#reportTableBody').innerHTML = `
      <tr>
        <td colspan="3" class="text-center py-6 text-gray-500 bg-gray-50">
          No report available for the selected date
        </td>
      </tr>
    `;
  }
}

// Page initialization
document.addEventListener('DOMContentLoaded', function() {
  document.querySelector('#reportDate').value = '2025-04-14';
  updateReport();
});

// Listen to changes on date and patient dropdown
document.querySelector('#reportDate').addEventListener('change', updateReport);
document.querySelector('#patientSelect').addEventListener('change', updateReport);
</script>
{% endblock %}